â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                            â•‘
â•‘          FIX: CHECK CONSTRAINT EN CAMPO ESTADO                            â•‘
â•‘                                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

================================================================================
PROBLEMA
================================================================================

ERROR:
django.db.utils.IntegrityError: new row for relation "equipos_gps" violates 
check constraint "equipos_gps_estado_check"

DETAIL: Failing row contains (..., stock, ...)

CAUSA:
La tabla tiene una restricciÃ³n CHECK que solo permite ciertos valores en la
columna estado, pero el frontend estaba enviando 'stock' que NO estÃ¡ permitido.

================================================================================
RESTRICCIÃ“N CHECK ENCONTRADA
================================================================================

Nombre: equipos_gps_estado_check

DefiniciÃ³n:
CHECK (estado IN ('activo', 'inactivo', 'mantenimiento', 'baja'))

VALORES PERMITIDOS:
  âœ“ 'activo'         - Equipo operativo en uso
  âœ“ 'inactivo'       - Equipo sin asignar (en stock)
  âœ“ 'mantenimiento'  - Equipo en reparaciÃ³n
  âœ“ 'baja'           - Equipo dado de baja

VALORES NO PERMITIDOS:
  âŒ 'stock'          - NO existe en la restricciÃ³n
  âŒ 'operativo'      - NO existe (se usa 'activo')
  âŒ cualquier otro

================================================================================
SOLUCIÃ“N APLICADA
================================================================================

1. FORMULARIO HTML (templates/equipos/index.html):

ANTES:
```html
<select class="form-select" id="estado">
    <option value="stock">En Stock</option>         âŒ
    <option value="operativo">Operativo</option>    âŒ
    <option value="mantenimiento">En Mantenimiento</option>
    <option value="baja">Dado de Baja</option>
</select>
```

DESPUÃ‰S:
```html
<select class="form-select" id="estado">
    <option value="inactivo">Inactivo (En Stock)</option>        âœ“
    <option value="activo">Activo (Operativo)</option>           âœ“
    <option value="mantenimiento">En Mantenimiento</option>      âœ“
    <option value="baja">Dado de Baja</option>                   âœ“
</select>
```

2. FILTRO (templates/equipos/index.html):

ANTES:
```html
<option value="operativo">Operativo</option>
<option value="stock">En Stock</option>
```

DESPUÃ‰S:
```html
<option value="activo">Activo</option>
<option value="inactivo">Inactivo</option>
```

3. JAVASCRIPT (static/js/equipos.js):

a) Valor por defecto:
```javascript
// ANTES:
estado: document.getElementById('estado').value || 'stock'

// DESPUÃ‰S:
estado: document.getElementById('estado').value || 'inactivo'
```

b) Badges:
```javascript
switch(equipo.estado) {
    case 'activo':        // En vez de 'operativo'
        estadoBadge = '<span class="badge badge-operativo">Activo</span>';
        break;
    case 'inactivo':      // En vez de 'stock'
        estadoBadge = '<span class="badge badge-stock">Inactivo</span>';
        break;
    case 'mantenimiento':
        estadoBadge = '<span class="badge badge-mantenimiento">Mantenimiento</span>';
        break;
    case 'baja':
        estadoBadge = '<span class="badge badge-baja">Baja</span>';
        break;
}
```

================================================================================
MAPEO DE VALORES
================================================================================

FRONTEND (usuario ve)          â†’  BACKEND (valor en BD)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"Inactivo (En Stock)"          â†’  'inactivo'
"Activo (Operativo)"           â†’  'activo'
"En Mantenimiento"             â†’  'mantenimiento'
"Dado de Baja"                 â†’  'baja'

================================================================================
COLORES DE BADGES
================================================================================

Estado         Color      Badge Class
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
activo         Verde      badge-operativo
inactivo       Gris       badge-stock
mantenimiento  Amarillo   badge-mantenimiento
baja           Rojo       badge-baja

================================================================================
VALIDACIÃ“N EN DJANGO (FUTURO)
================================================================================

Si quieres agregar validaciÃ³n en el modelo:

```python
class Equipo(models.Model):
    ESTADO_CHOICES = [
        ('activo', 'Activo'),
        ('inactivo', 'Inactivo'),
        ('mantenimiento', 'Mantenimiento'),
        ('baja', 'Baja'),
    ]
    
    estado = models.CharField(
        max_length=20,
        choices=ESTADO_CHOICES,
        default='inactivo',
        null=True,
        blank=True
    )
```

NOTA: Como managed=False, esto es solo para validaciÃ³n en Django,
no cambia la restricciÃ³n CHECK de la base de datos.

================================================================================
AHORA DEBERÃA FUNCIONAR
================================================================================

1. El navegador ya debe estar mostrando la pÃ¡gina actualizada
   (puedes hacer Ctrl+F5 para forzar recarga)

2. Crea un equipo de prueba:
   - IMEI: 123456789012345
   - Marca: Teltonika
   - Modelo: FMB920
   - Estado: "Inactivo (En Stock)"  â† Ahora usarÃ¡ 'inactivo' âœ“
   - Guardar

3. El equipo se crearÃ¡ correctamente en equipos_gps

4. VerÃ¡s el badge gris "Inactivo"

================================================================================

âœ… Frontend actualizado con valores correctos del CHECK constraint!

ğŸ”§ Valores alineados con la restricciÃ³n de la base de datos
âœ… Ya no enviarÃ¡ valores no permitidos
ğŸš€ Listo para crear equipos

Recarga la pÃ¡gina (Ctrl+F5) y prueba crear tu primer equipo!

================================================================================
